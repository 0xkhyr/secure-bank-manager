<!-- Reusable Management Modal -->
<div id="managementModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;" onclick="hideManagementModal()">
    <div style="background: var(--surface); border-radius: 8px; padding: 24px; max-width: 500px; width: 90%;" onclick="event.stopPropagation()">
        <h3 id="mgmtModalTitle" style="font-size: 18px; font-weight: 500; margin-bottom: 16px;"></h3>
        <form id="mgmtModalForm" method="post" action="">
            <input type="hidden" id="mgmtModalExtra" name="" value="">
            <div style="margin-bottom: 20px;">
                <label id="mgmtReasonLabel" for="mgmtRaison" style="display: block; font-size: 14px; font-weight: 500; margin-bottom: 8px;">Raison *</label>
                <select id="mgmtRaison" name="raison" required 
                    style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 6px; font-size: 14px; background: #fafafa; color: var(--text-primary); cursor: pointer; transition: border-color 0.2s, box-shadow 0.2s; appearance: none; -webkit-appearance: none; background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2224%22%20height%3D%2224%22%20viewBox%3D%220%200%2024%2024%22%20fill%3D%22none%22%20stroke%3D%22%23757575%22%20stroke-width%3D%222%22%20stroke-linecap%3D%22round%22%20stroke-linejoin%3D%22round%22%3E%3Cpolyline%20points%3D%226%209%2012%2015%2018%209%22%3E%3C%2Fpolyline%3E%3C%2Fsvg%3E'); background-repeat: no-repeat; background-position: right 12px center; background-size: 16px;">
                </select>
            </div>
            <div style="margin-bottom: 20px;">
                <label for="mgmtCommentaire" style="display: block; font-size: 14px; font-weight: 500; margin-bottom: 8px;">Commentaire (optionnel)</label>
                <textarea id="mgmtCommentaire" name="commentaire" rows="3" 
                    placeholder="Ajoutez des détails sur votre décision..."
                    style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 6px; font-size: 14px; background: #fafafa; color: var(--text-primary); resize: vertical; transition: border-color 0.2s, box-shadow 0.2s;"></textarea>
            </div>
            <style>
                #mgmtRaison:focus, #mgmtCommentaire:focus {
                    outline: none;
                    border-color: var(--primary-color, #1a73e8) !important;
                    box-shadow: 0 0 0 3px rgba(26, 115, 232, 0.1);
                    background-color: #ffffff;
                }
                #mgmtRaison:hover, #mgmtCommentaire:hover {
                    border-color: #bdbdbd;
                }
            </style>
            <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px;">
                <button type="button" class="btn" onclick="hideManagementModal()">Annuler</button>
                <button id="mgmtModalSubmit" type="submit" class="btn btn-primary"></button>
            </div>
        </form>
    </div>
</div>

<script>
function showManagementModal(config) {
    const modal = document.getElementById('managementModal');
    const form = document.getElementById('mgmtModalForm');
    const select = document.getElementById('mgmtRaison');
    const submit = document.getElementById('mgmtModalSubmit');
    const extraInput = document.getElementById('mgmtModalExtra');
    const title = document.getElementById('mgmtModalTitle');
    
    title.textContent = config.title;
    form.action = config.action;
    submit.textContent = config.submitText;
    submit.style.cssText = config.submitStyle;
    
    // Handle extra hidden fields (like 'statut')
    if (config.extraField) {
        extraInput.name = config.extraField.name;
        extraInput.value = config.extraField.value;
        extraInput.style.display = 'inline'; // Ensure it's active in the form mapping
    } else {
        extraInput.name = "";
        extraInput.value = "";
    }
    
    // Populate reasons with a default empty option
    let options = '<option value="" disabled selected>-- Sélectionner une raison --</option>';
    options += config.reasons.map(r => `<option value="${r}">${r}</option>`).join('');
    select.innerHTML = options;
    
    modal.style.display = 'flex';
    document.body.style.overflow = 'hidden';
}

function hideManagementModal() {
    document.getElementById('managementModal').style.display = 'none';
    document.getElementById('mgmtCommentaire').value = '';
    document.body.style.overflow = 'auto';
}
</script>
